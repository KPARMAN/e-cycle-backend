<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chat - Seller Support</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: #f5f5f5;
      height: 100vh;
      overflow: hidden;
    }

    .chat-container {
      display: flex;
      height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: 300px;
      background: white;
      border-right: 1px solid #e0e0e0;
      display: flex;
      flex-direction: column;
    }

    .sidebar-header {
      padding: 20px;
      border-bottom: 1px solid #e0e0e0;
    }

    .sidebar-header h2 {
      font-size: 18px;
      color: #333;
      margin-bottom: 15px;
    }

    .user-info {
      background: #f9f9f9;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 15px;
    }

    .user-info label {
      display: block;
      font-size: 12px;
      color: #666;
      margin-bottom: 5px;
    }

    .user-info input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      margin-bottom: 8px;
    }

    .user-type-select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      margin-bottom: 8px;
    }

    .conversation-list {
      flex: 1;
      overflow-y: auto;
      padding: 0;
    }

    .conversation-item {
      padding: 15px;
      border-bottom: 1px solid #f0f0f0;
      cursor: pointer;
      transition: background 0.2s;
    }

    .conversation-item:hover {
      background: #f9f9f9;
    }

    .conversation-item.active {
      background: #e3f2fd;
      border-left: 4px solid #2196F3;
    }

    .conversation-item-name {
      font-weight: 600;
      color: #333;
      font-size: 14px;
      margin-bottom: 4px;
    }

    .conversation-item-preview {
      font-size: 12px;
      color: #999;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Main Chat Area */
    .chat-main {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: white;
    }

    .chat-header {
      padding: 20px;
      border-bottom: 1px solid #e0e0e0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .chat-header h3 {
      font-size: 18px;
      margin-bottom: 4px;
    }

    .chat-header p {
      font-size: 12px;
      opacity: 0.9;
    }

    .messages-area {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .message {
      display: flex;
      gap: 10px;
      margin-bottom: 8px;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .message.sent {
      justify-content: flex-end;
    }

    .message.received {
      justify-content: flex-start;
    }

    .message-bubble {
      max-width: 60%;
      padding: 12px 16px;
      border-radius: 12px;
      word-wrap: break-word;
      font-size: 14px;
    }

    .message.sent .message-bubble {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-bottom-right-radius: 4px;
    }

    .message.received .message-bubble {
      background: #f0f0f0;
      color: #333;
      border-bottom-left-radius: 4px;
    }

    .message-time {
      font-size: 11px;
      color: #999;
      margin-top: 4px;
      padding: 0 6px;
    }

    .message.sent .message-time {
      text-align: right;
    }

    /* Input Area */
    .input-area {
      padding: 20px;
      border-top: 1px solid #e0e0e0;
      background: white;
      display: flex;
      gap: 10px;
    }

    .input-area input {
      flex: 1;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 24px;
      font-size: 14px;
      transition: border-color 0.2s;
    }

    .input-area input:focus {
      outline: none;
      border-color: #667eea;
    }

    .input-area button {
      padding: 12px 24px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 24px;
      cursor: pointer;
      font-weight: 600;
      transition: transform 0.2s;
    }

    .input-area button:hover {
      transform: translateY(-2px);
    }

    .input-area button:active {
      transform: translateY(0);
    }

    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: #999;
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 10px;
    }

    .empty-state-text {
      font-size: 16px;
    }

    @media (max-width: 768px) {
      .sidebar {
        width: 250px;
      }

      .message-bubble {
        max-width: 80%;
      }
    }

    @media (max-width: 600px) {
      .chat-container {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        height: 150px;
        border-right: none;
        border-bottom: 1px solid #e0e0e0;
      }

      .chat-main {
        flex: 1;
      }

      .sidebar-header {
        padding: 15px;
      }

      .conversation-list {
        display: flex;
        gap: 10px;
        padding: 10px;
        overflow-x: auto;
      }

      .conversation-item {
        flex-shrink: 0;
        min-width: 150px;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 8px;
        border-bottom: none;
      }
    }
  </style>
</head>
<body>
  <div class="chat-container">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <h2>üí¨ Conversations</h2>
        <div class="user-info">
          <label>Your Name:</label>
          <input type="text" id="userName" placeholder="Enter your name" value="User" />
          <label>User Type:</label>
          <select id="userType" class="user-type-select">
            <option value="buyer">Buyer</option>
            <option value="seller">Seller</option>
          </select>
        </div>
      </div>
      <div class="conversation-list" id="conversationList"></div>
    </div>

    <!-- Main Chat Area -->
    <div class="chat-main">
      <div class="chat-header" id="chatHeader">
        <h3>Select a conversation to start</h3>
        <p>Click a seller or conversation below</p>
      </div>

      <div class="messages-area" id="messagesArea">
        <div class="empty-state">
          <div class="empty-state-icon">üí¨</div>
          <div class="empty-state-text">No messages yet</div>
        </div>
      </div>

      <div class="input-area" id="inputArea" style="display: none;">
        <input
          type="text"
          id="messageInput"
          placeholder="Type your message..."
          autocomplete="off"
        />
        <button id="sendBtn">Send</button>
      </div>
    </div>
  </div>

  <script>
    const BASE = (location.protocol === 'file:') ? 'http://localhost:4000' : `${location.protocol}//${location.host}`;

    // State management
    let currentConversationId = null;
    let userName = document.getElementById('userName').value;
    let userType = document.getElementById('userType').value;
    let conversations = {};
    let messages = {};

    // Sample sellers/conversations
    const sampleConversations = [
      { id: '1', name: 'Electronics Store', type: 'seller', preview: 'What\'s the warranty...' },
      { id: '2', name: 'John\'s Shop', type: 'seller', preview: 'Available in blue and red' },
      { id: '3', name: 'FastShip Seller', type: 'seller', preview: 'Shipping tomorrow' },
      { id: '4', name: 'Premium Deals', type: 'seller', preview: 'Special discount for you' }
    ];

    // Initialize
    function init() {
      loadConversations();
      setupEventListeners();
    }

    function loadConversations() {
      sampleConversations.forEach(conv => {
        conversations[conv.id] = conv;
        messages[conv.id] = [];
      });
      renderConversationList();
    }

    function renderConversationList() {
      const list = document.getElementById('conversationList');
      list.innerHTML = '';
      Object.values(conversations).forEach(conv => {
        const div = document.createElement('div');
        div.className = 'conversation-item' + (conv.id === currentConversationId ? ' active' : '');
        div.innerHTML = `
          <div class="conversation-item-name">${conv.name}</div>
          <div class="conversation-item-preview">${messages[conv.id]?.length ? messages[conv.id][messages[conv.id].length - 1].text : 'No messages yet'}</div>
        `;
        div.addEventListener('click', () => selectConversation(conv.id));
        list.appendChild(div);
      });
    }

    function selectConversation(id) {
      currentConversationId = id;
      const conv = conversations[id];

      // Update header
      const header = document.getElementById('chatHeader');
      header.innerHTML = `
        <h3>${conv.name}</h3>
        <p>${conv.type === 'seller' ? 'üè™ Seller' : 'üë§ Buyer'}</p>
      `;

      // Show input area
      document.getElementById('inputArea').style.display = 'flex';

      // Render messages
      renderMessages();
      renderConversationList();

      // Focus input
      document.getElementById('messageInput').focus();
    }

    function renderMessages() {
      const area = document.getElementById('messagesArea');
      const convMessages = messages[currentConversationId] || [];

      area.innerHTML = '';
      if (convMessages.length === 0) {
        area.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üí¨</div>
            <div class="empty-state-text">No messages yet. Say hello!</div>
          </div>
        `;
        return;
      }

      convMessages.forEach(msg => {
        const div = document.createElement('div');
        const isSent = msg.sender === userName;
        div.className = 'message ' + (isSent ? 'sent' : 'received');
        div.innerHTML = `
          <div>
            <div class="message-bubble">${escapeHtml(msg.text)}</div>
            <div class="message-time">${formatTime(msg.timestamp)}</div>
          </div>
        `;
        area.appendChild(div);
      });

      // Scroll to bottom
      area.scrollTop = area.scrollHeight;
    }

    function sendMessage() {
      const input = document.getElementById('messageInput');
      const text = input.value.trim();

      if (!text || !currentConversationId) return;

      const message = {
        id: Date.now(),
        sender: userName,
        text: text,
        timestamp: new Date(),
        userType: userType
      };

      messages[currentConversationId].push(message);
      input.value = '';
      renderMessages();
      renderConversationList();

      // Simulate seller response after 1 second (optional)
      if (userType === 'buyer') {
        setTimeout(() => {
          const response = {
            id: Date.now(),
            sender: conversations[currentConversationId].name,
            text: generateSellerResponse(text),
            timestamp: new Date(),
            userType: 'seller'
          };
          messages[currentConversationId].push(response);
          renderMessages();
          renderConversationList();
        }, 1000);
      }
    }

    function generateSellerResponse(userMessage) {
      const responses = [
        'Thank you for your message! How can I help you?',
        'Great question! Let me check that for you.',
        'I appreciate your interest. Can you tell me more details?',
        'Thanks for reaching out. We have that in stock!',
        'I\'ll get back to you shortly with more information.',
        'What color or size would you prefer?',
        'We offer free shipping on this item!',
        'This is one of our bestsellers. Interested?'
      ];
      return responses[Math.floor(Math.random() * responses.length)];
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function formatTime(date) {
      const hours = date.getHours().toString().padStart(2, '0');
      const minutes = date.getMinutes().toString().padStart(2, '0');
      return `${hours}:${minutes}`;
    }

    function setupEventListeners() {
      document.getElementById('sendBtn').addEventListener('click', sendMessage);
      document.getElementById('messageInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendMessage();
      });

      document.getElementById('userName').addEventListener('change', (e) => {
        userName = e.target.value;
      });

      document.getElementById('userType').addEventListener('change', (e) => {
        userType = e.target.value;
      });
    }

    init();
  </script>
</body>
</html>
